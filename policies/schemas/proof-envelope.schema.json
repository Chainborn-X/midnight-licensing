{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://chainborn.io/schemas/proof-envelope.schema.json",
  "title": "Midnight License Proof Envelope",
  "description": "Canonical JSON envelope format for Midnight license proofs, enabling portable proof distribution and offline validation in .NET applications",
  "type": "object",
  "required": [
    "proofBytes",
    "verificationKeyBytes",
    "productId",
    "challenge"
  ],
  "properties": {
    "$schema": {
      "type": "string",
      "description": "JSON Schema reference for validation"
    },
    "version": {
      "type": "string",
      "description": "Proof envelope format version (semver). Optional for extensibility. Default is 1.0.0 if not specified.",
      "pattern": "^\\d+\\.\\d+\\.\\d+$",
      "default": "1.0.0"
    },
    "proofBytes": {
      "type": "string",
      "description": "Base64-encoded zk-SNARK proof data (serialized curve points). This is the actual cryptographic proof generated by the Midnight proof server.",
      "minLength": 1,
      "pattern": "^[A-Za-z0-9+/]+=*$"
    },
    "verificationKeyBytes": {
      "type": "string",
      "description": "Base64-encoded verification key containing G1 and G2 elliptic curve group elements. Required to verify the proof.",
      "minLength": 1,
      "pattern": "^[A-Za-z0-9+/]+=*$"
    },
    "productId": {
      "type": "string",
      "description": "Unique product identifier that this proof is valid for. Must match the product ID in the license policy.",
      "minLength": 1
    },
    "challenge": {
      "type": "object",
      "description": "Challenge data for anti-replay protection. The nonce ensures proofs cannot be reused across different validation contexts.",
      "required": [
        "nonce",
        "issuedAt",
        "expiresAt"
      ],
      "properties": {
        "nonce": {
          "type": "string",
          "description": "Base64-encoded cryptographic nonce for anti-replay protection. Generated by the validator or provided by the customer at proof generation time.",
          "minLength": 1,
          "pattern": "^[A-Za-z0-9+/]+=*$"
        },
        "issuedAt": {
          "type": "string",
          "description": "ISO 8601 timestamp indicating when the challenge was issued.",
          "format": "date-time"
        },
        "expiresAt": {
          "type": "string",
          "description": "ISO 8601 timestamp indicating when the challenge expires. After this time, the proof must be regenerated.",
          "format": "date-time"
        }
      },
      "additionalProperties": false
    },
    "metadata": {
      "type": "object",
      "description": "Optional extensible metadata for additional proof context, debugging, and future ZK system enhancements. Not validated cryptographically.",
      "properties": {
        "generatedAt": {
          "type": "string",
          "description": "ISO 8601 timestamp when the proof was generated",
          "format": "date-time"
        },
        "proofServerVersion": {
          "type": "string",
          "description": "Version of the Midnight proof server used to generate this proof"
        },
        "tier": {
          "type": "string",
          "description": "License tier (e.g., community, professional, enterprise)"
        },
        "features": {
          "type": "array",
          "description": "List of enabled feature flags",
          "items": {
            "type": "string"
          },
          "uniqueItems": true
        },
        "customerId": {
          "type": "string",
          "description": "Optional customer identifier for tracking purposes (not validated cryptographically)"
        }
      },
      "additionalProperties": true
    }
  },
  "additionalProperties": false
}
